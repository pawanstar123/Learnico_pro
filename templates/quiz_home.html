{% extends 'app.html' %}
{% block content %}

<div class="header-section">
    <div class="dashboard-navbar">
        <div class="nav-brand">üéÆ Quiz Arena</div>
        <div class="nav-links">
            <a href="/Dashboard" class="nav-link">Dashboard</a>
            <a href="/leaderboard" class="nav-link">Leaderboard</a>
            <a href="/profile" class="nav-link profile-icon">üë§</a>
        </div>
    </div>
</div>

<div class="container" style="margin-top: 20px;">
    <div class="quiz-hero">
        <h1>üéØ Quiz Battle Arena</h1>
        <p>Challenge players and climb the leaderboard!</p>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="player-stats-card">
        <h3>Your Stats</h3>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Rating</div>
                <div class="stat-value">{{ user[4] if user[4] else 1000 }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Matches</div>
                <div class="stat-value">{{ user[5] if user[5] else 0 }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Wins</div>
                <div class="stat-value">{{ user[6] if user[6] else 0 }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total XP</div>
                <div class="stat-value">{{ user[7] if user[7] else 0 }}</div>
            </div>
        </div>
    </div>

    <!-- Difficulty Selection -->
    <div class="difficulty-selection" id="difficulty-selection">
        <h3>üìö Select Your Level</h3>
        <p style="text-align: center; color: #666; margin-bottom: 25px;">
            Choose difficulty based on your standard
        </p>
        
        <div class="difficulty-cards">
            <div class="difficulty-card" onclick="selectDifficulty('easy')">
                <div class="difficulty-icon">‚úèÔ∏è</div>
                <h4>Easy</h4>
                <p>Below 6th Standard</p>
                <div class="difficulty-badge easy">Beginner Level</div>
            </div>
            
            <div class="difficulty-card" onclick="selectDifficulty('medium')">
                <div class="difficulty-icon">üìñ</div>
                <h4>Medium</h4>
                <p>6th to 8th Standard</p>
                <div class="difficulty-badge medium">Intermediate Level</div>
            </div>
            
            <div class="difficulty-card" onclick="selectDifficulty('hard')">
                <div class="difficulty-icon">üéì</div>
                <h4>Hard</h4>
                <p>9th to 12th Standard</p>
                <div class="difficulty-badge hard">Advanced Level</div>
            </div>
        </div>
    </div>

    <div class="quiz-actions" style="display:none;" id="quiz-actions">
        <button class="btn btn-dark btn-large" onclick="findMatch()">
            ‚öîÔ∏è Find Match
        </button>
        <button class="btn btn-outline btn-large" onclick="changeDifficulty()">
            üîÑ Change Level
        </button>
    </div>

    <div id="matchmaking-status" style="display:none; text-align:center; margin-top:20px;">
        <div class="loading-spinner">üîÑ</div>
        <p>Finding opponent...</p>
    </div>
</div>

<script>
let selectedDifficulty = null;

function selectDifficulty(level) {
    selectedDifficulty = level;
    document.getElementById('difficulty-selection').style.display = 'none';
    document.getElementById('quiz-actions').style.display = 'flex';
    
    // Show confirmation
    const levelNames = {
        'easy': 'Easy (Below 6th Standard)',
        'medium': 'Medium (6th-8th Standard)',
        'hard': 'Hard (9th-12th Standard)'
    };
    
    alert('‚úÖ Level selected: ' + levelNames[level] + '\n\nClick "Find Match" to start!');
}

function changeDifficulty() {
    selectedDifficulty = null;
    document.getElementById('difficulty-selection').style.display = 'block';
    document.getElementById('quiz-actions').style.display = 'none';
}

function findMatch() {
    if (!selectedDifficulty) {
        alert('Please select a difficulty level first!');
        return;
    }
    
    document.getElementById('matchmaking-status').style.display = 'block';
    
    fetch('/quiz/matchmaking', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            difficulty: selectedDifficulty
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.error) {
            alert('Error: ' + data.error);
            document.getElementById('matchmaking-status').style.display = 'none';
        } else {
            window.location.href = '/quiz/match/' + data.match_id;
        }
    })
    .catch(err => {
        alert('Error finding match: ' + err);
        document.getElementById('matchmaking-status').style.display = 'none';
    });
}
</script>

<style>
.quiz-hero {
    text-align: center;
    padding: 40px 20px;
    background: linear-gradient(135deg, #6200ff, #8f3dff);
    border-radius: 20px;
    color: white;
    margin-bottom: 30px;
}

.quiz-hero h1 {
    margin: 0 0 10px 0;
    font-size: 36px;
}

.quiz-hero p {
    margin: 0;
    font-size: 18px;
    opacity: 0.9;
}

.player-stats-card {
    background: white;
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    margin-bottom: 30px;
}

.player-stats-card h3 {
    margin: 0 0 20px 0;
    color: #6200ff;
}

.quiz-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
}

.btn-large {
    padding: 18px 40px;
    font-size: 18px;
    min-width: 200px;
}

.loading-spinner {
    font-size: 48px;
    animation: spin 2s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.difficulty-selection {
    background: white;
    padding: 40px 30px;
    border-radius: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    margin-bottom: 30px;
}

.difficulty-selection h3 {
    text-align: center;
    color: #6200ff;
    margin: 0 0 10px 0;
    font-size: 28px;
}

.difficulty-cards {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-top: 20px;
}

.difficulty-card {
    background: #f8f8f8;
    border: 3px solid #e0e0e0;
    border-radius: 20px;
    padding: 30px 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.difficulty-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(98, 0, 255, 0.2);
    border-color: #6200ff;
}

.difficulty-icon {
    font-size: 48px;
    margin-bottom: 15px;
}

.difficulty-card h4 {
    margin: 0 0 10px 0;
    color: #333;
    font-size: 22px;
}

.difficulty-card p {
    margin: 0 0 15px 0;
    color: #666;
    font-size: 14px;
}

.difficulty-badge {
    display: inline-block;
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
}

.difficulty-badge.easy {
    background: #d1ecf1;
    color: #0c5460;
}

.difficulty-badge.medium {
    background: #fff3cd;
    color: #856404;
}

.difficulty-badge.hard {
    background: #f8d7da;
    color: #721c24;
}

@media screen and (max-width: 768px) {
    .quiz-hero h1 { font-size: 28px; }
    .quiz-hero p { font-size: 16px; }
    .btn-large { min-width: 100%; }
    
    .difficulty-cards {
        grid-template-columns: 1fr;
    }
    
    .difficulty-selection {
        padding: 30px 20px;
    }
}
</style>

{% endblock %}
